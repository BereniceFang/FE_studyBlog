<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<script type="text/javascript" src="jquery.js"></script>
<style type="text/css">
  .choose-date{
    width: 640px;
    height: 370px;
    overflow-y: hidden;
    background-color: #ec6a5c;
  }
  .choose-date ul{
    margin: 0;
    padding: 0;
    list-style: none;
    display: inline-block;
    vertical-align: top;
    text-align: center;
    width: 200px;
  }
  .choose-date li{
    width: 200px;
    height: 125px;
    font-size: 40px;
    line-height: 125px;
    color: #fff;
  }
</style>
<body>
  <div class="choose-date">
    <ul id="ul-year"></ul>
    <ul id="ul-month"></ul>
    <ul id="ul-day"></ul>
  </div>
</body>
<script>
  var today = new Date()
  var currentYear = today.getFullYear(),
      currentMonth = today.getMonth()+1,
      currentDay = today.getDate()
  var height = 125 

  //判断闰年
  function isLeapyear(year){
    if ((year%4==0) && (year%100!==0) || (year%400==0)){
      return true
    }else{
      return false
    }
  }

  //判断是否是31天的月份
  function isDay31(month){
    var arr = [1,3,5,7,8,10,12]
    for(var x of arr){
      if(month == x){
        return true
      }
    }
    return false
  }

  //初始化年 1900-2016
  var year = [],
    str = ""
  for(var i = 1900; i <= 2016; i++){
    year.push(i)
  }
  for(var x of year){
    str = str.concat("<li>"+x+"</li>")
  }
  $('#ul-year').append(str)
  for(var x in year){
    var index
    if(currentYear == year[x]){
      index = x
    }
  }
  var temp = 0 - (index - 1) * height
  $('#ul-year')[0].style.marginTop = temp + 'px'

  //初始化月份
  var month = []
  str = ""
  for(var i = 1; i <= 12; i++){
    month.push(i)
  }
  for(var x of month){
    str = str.concat("<li>"+x+"</li>")
  }
  $('#ul-month').append(str)
  for(var x in month){
    index
    if(currentMonth == month[x]){
      index = x
    }
  }
  temp = 0 - (index - 1) * height
  $('#ul-month')[0].style.marginTop = temp + 'px'

  //初始化天
  var day28 = [],
      day29 = [],
      day30 = [],
      day31 = []
  for(var i = 1; i <= 28; i++){
    day28.push(i)
    day29.push(i)
    day30.push(i)
    day31.push(i)
  }
  day29.push(29)
  day30.push(29,30)
  day31.push(29,30,31)
  str = ""
  for(var x of day31){
    str = str.concat("<li>"+x+"</li>")
  }
  $('#ul-day').append(str)
  //改变不同月不同的天数
  function chageDateNum (day) {
    str = ""
    for(var x of arr){
      str = str.concat("<li>"+x+"</li>")
    }
    $('#ul-day').empty()
    $('#ul-day').append(str)
  }
  var day = day31
  for(var x in day){
    index
    if(currentDay == day[x]){
      index = x
    }
  }
  temp = 0 - (index - 1) * height
  $('#ul-day')[0].style.marginTop = temp + 'px'

  //滑动年
  var touchstartYear,
      currentTopYear,
      moveYYear,
      nowTopYear,
      maxYear = 0 - (year.length - 2) * height,
      $year = $('#ul-year')[0]
  $year.addEventListener('touchstart', function(e){
    currentTopYear = parseInt($year.style.marginTop) || 0
    touchstartYear = e.targetTouches[0].clientY
  })
  $year.addEventListener('touchmove', function(e){
    moveYYear = e.targetTouches[0].clientY
    nowTopYear = currentTopYear + (moveYYear - touchstartYear)
    if(nowTopYear > maxYear && nowTopYear < height){
      $year.style.marginTop = nowTopYear + 'px'
    }
  })
  $year.addEventListener('touchend', function(e){
    var now
    if(nowTopYear % height >= height/2){
      if(nowTopYear < maxYear){
        now = maxYear
      }else if(nowTopYear > height){
        now = height
      }else{
        now = nowTopYear + height - (nowTopYear % height)
      }
    }else{
      now = nowTopYear - (nowTopYear % height)
      if(nowTopYear < maxYear){
        now = maxYear
      }else if(nowTopYear > height){
        now = height
      }else{
        now = nowTopYear - (nowTopYear % height)
      }
    }
    $year.style.marginTop = now + 'px'
    currentYear = 1900 - now/height +1
  })

  //滑动月
  var touchstartMonth,
      currentTopMonth,
      moveYMonth,
      nowTopMonth,
      maxMonth = 0 - (month.length - 2) * height,
      $month = $('#ul-month')[0]
  $month.addEventListener('touchstart', function(e){
    currentTopMonth = parseInt($month.style.marginTop) || 0
    touchstartMonth = e.targetTouches[0].clientY
  })
  $month.addEventListener('touchmove', function(e){
    moveYMonth = e.targetTouches[0].clientY
    nowTopMonth = currentTopMonth + (moveYMonth - touchstartMonth)
    if(nowTopMonth > maxMonth && nowTopMonth < height){
      $month.style.marginTop = nowTopMonth + 'px'   
    }
  })
  $month.addEventListener('touchend', function(e){
    var now
    if(nowTopMonth % height >= height/2){
      if(nowTopMonth < maxMonth){
        now = maxMonth
      }else if(nowTopMonth > height){
        now = height
      }else{
        now = nowTopMonth + height - (nowTopMonth % height)
      }
    }else{
      now = nowTopMonth - (nowTopMonth % height)
      if(nowTopMonth < maxMonth){
        now = maxMonth
      }else if(nowTopMonth > height){
        now = height
      }else{
        now = nowTopMonth - (nowTopMonth % height)
      }
    }
    $month.style.marginTop = now + 'px'
  })

  //滑动日
  var touchstartDay,
      currentTopDay,
      moveYDay,
      nowTopDay,
      maxDay = 0 - (day.length - 2) * height,
      $day = $('#ul-day')[0]
  $day.addEventListener('touchstart', function(e){
    currentTopDay = parseInt($day.style.marginTop) || 0
    touchstartDay = e.targetTouches[0].clientY
  })
  $day.addEventListener('touchmove', function(e){
    moveYDay = e.targetTouches[0].clientY
    nowTopDay = currentTopDay + (moveYDay - touchstartDay)
    if(nowTopDay > maxDay && nowTopDay < height){
      $day.style.marginTop = nowTopDay + 'px'
    }
  })
  $day.addEventListener('touchend', function(e){
    var now
    if(nowTopDay % height >= height/2){
      if(nowTopDay < maxDay){
        now = maxDay
      }else if(nowTopDay > height){
        now = height
      }else{
        now = nowTopDay + height - (nowTopDay % height)
      }
    }else{
      now = nowTopDay - (nowTopDay % height)
      if(nowTopDay < maxDay){
        now = maxDay
      }else if(nowTopDay > height){
        now = height
      }else{
        now = nowTopDay - (nowTopDay % height)
      }
    }
    $day.style.marginTop = now + 'px'
  })
</script>
</html>
