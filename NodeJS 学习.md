# NodeJS 学习
## 预备知识

###关于权限
1. 使用`sudo`命令运行 NodeJs
2. 使用`sudo chmod +s`运行
第一种方法更推荐，可保证只让当前有需要的 js 脚本提供 root 权限，后一种让 NodeJS 始终以 root 权限运行，不安全。

###模块化
在 NodeJS 中一般会拆分成不同的 js 文件，每个文件就是一个模块，文件路径就是模块名。
1. `requir` 函数可以用来加载其他的模块，模块名可以用绝对路径、相对路径或者文件名，其中`.js`的文件扩展名可省略。
2. `exports`对象是当前模块导出的对象，导出模块提供的公有方法和属性。其他模块通过`requir` 函数引入的就是`exports`导出的对象。
3.  `module`对象可访问当前模块的信息，主要用途是替换当前模块的导出对象。例如：把默认的`exports`对象换成`exports`一个函数。
4. 模块初始化，一个模块中的 js 代码仅在模块第一次被使用时执行一次，并初始化模块的导出对象，之后导出的对象会被重复利用。
5. 主模块，通过命令行参数传递给NodeJS以启动程序的模块被称为主模块。主模块负责调度组成整个程序的其它模块完成工作。

###二进制模块
使用C/C++编写的叫二进制模块。编译好的二进制模块除了文件扩展名是`.node`外，和JS模块的使用方式相同。二进制模块能使用操作系统提供的所有功能，但难以跨平台使用。

###模块路径解析规则
1. 内置模块，如果是	NodeJS 内置模块名称，则不做路径解析。
2. `node-modules`目录， NodeJS 定义的存放模块的目录。
3. `NODE_PATH`环境变量，允许指定额外的模块搜索路径，可以写多个， Linux 下用`:`分隔， Windows 下用`;`分隔。

###包

把多个子模块组成的大模块称做包，并把所有子模块放在同一个目录里。在组成一个包的所有子模块中，需要有一个入口模块，入口模块的导出对象被作为包的导出对象。

1. `index.js` 文件名为 `index.js`时，可以用模块所在目录的路径代替文件路径。
2. `package.json` 在包目录下创建`package.json`文件，在里面指定入口模块的路径，就可以像上一种方法一样的路径去引入包， NodeJS 会根据`package.json`找到入口模块。

###命令行程序

在 Linux 中，可以把 JS 文件当做 shell 脚本运行。

1. 在主模块的顶部加上`#! /usr/bin/env node`，shell脚本中`#!`注释被用来指定解析器，而 NodeJS 会忽略`#!`后的注释内容。
2. 用`chomod +x`给文件授权。
3. 在 PATH 环境变量中指定的目录下，创建一个软链文件`sudo ln -s /home/user/bin/node-echo.js /usr/local/bin/node-echo`。

###NPM
随同NodeJS一起安装的包管理工具。

1. 下载三方包。
	* 	最新版本 `npm install packageName`
	* 指定版本 `npm install packageName@version`
	* 在`package.json`中写入包名和版本，通过`npm install`批量安装 
2. 安装命令行程序	

	`npm install packageName -g`，其中-g 表示全局安装  
3. 发布代码

	注册帐号，运行`npm adduser`，搞定后，编辑`package.json`，加入 NPM 必需字段，在运行`npm publish`发布
	
```
{
    "name": "node-echo",           # 包名，在NPM服务器上须要保持唯一
    "version": "1.0.0",            # 当前版本号
    "dependencies": {              # 三方包依赖，需要指定包名和版本号
        "argv": "0.0.2"
      },
    "main": "./lib/echo.js",       # 入口模块位置
    "bin" : {
        "node-echo": "./bin/node-echo"      # 命令行程序名和主模块位置
    }
}
``` 	

4. 版本号

	版本号分为 `x.y.z`三位，表示主版本号、次版本号和补丁版本号

###总结
* NodeJS是一个JS脚本解析器。
* 终端下输入node命令可进入命令交互模式，可以用来测试JS代码片段。
* NodeJS使用CMD模块系统，主模块作为程序入口点，所有模块在执行过程中只初始化一次。
* 二进制模块虽然可选用的功能全，但难以跨平台使用。
* 编写代码前要先规划好目录结构。
* 稍大些的程序可以将代码拆分为多个模块管理，更大些的程序可以使用包来组织模块。
* 合理使用node_modules和NODE_PATH来解耦包的使用方式和物理路径。
* 使用NPM可以看到实现了各种功能的包。

##文本操作



